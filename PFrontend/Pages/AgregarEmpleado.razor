@page "/empleados/agregar"
@inject HttpClient Http
@inject NavigationManager Navigation
@inject IJSRuntime JS
@using PFrontend.Models
@using System.Net.Http.Json
@using Microsoft.AspNetCore.Components.Forms
@using PFrontend.Models.PFrontend.Models

<h3>➕ Agregar Empleado</h3>

<EditForm Model="empleado" OnValidSubmit="GuardarEmpleado">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label class="form-label">Nombre</label>
        <InputText @bind-Value="empleado.Nombre" class="form-control" />
    </div>
    <div class="mb-3">
        <label class="form-label">Apellido</label>
        <InputText @bind-Value="empleado.Apellido" class="form-control" />
    </div>
    <div class="mb-3">
        <label class="form-label">DPI</label>
        <InputText @bind-Value="empleado.Dpi" class="form-control" />
    </div>
    <div class="mb-3">
        <label class="form-label">Correo</label>
        <InputText @bind-Value="empleado.Correo" class="form-control" />
    </div>
    <div class="mb-3">
        <label class="form-label">Salario</label>
        <InputNumber @bind-Value="empleado.Salario" class="form-control" />
    </div>
    <div class="mb-3">
        <label class="form-label">Departamento</label>
        <InputNumber @bind-Value="empleado.DepartamentoId" class="form-control" />
    </div>
    <div class="mb-3">
        <label class="form-label">Puesto</label>
        <InputNumber @bind-Value="empleado.PuestoId" class="form-control" />
    </div>

    <button type="submit" class="btn btn-primary">Guardar</button>
    <button class="btn btn-secondary ms-2" @onclick='() => Navigation.NavigateTo("/empleados")'>Cancelar</button>
</EditForm>

@code {
    private Empleado empleado = new();

    private async Task GuardarEmpleado()
    {
        var response = await Http.PostAsJsonAsync("api/Empleados", empleado);

        if (response.IsSuccessStatusCode)
        {
            Navigation.NavigateTo("/empleados");
        }
        else
        {
            await JS.InvokeVoidAsync("alert", $"Error al guardar: {response.StatusCode}");
        }
    }
}
